#Reminiscor is a free offline password manager.
#Copyright (C) 2020 Arjun Somvanshi & Manvendra Somvanshi

#This program is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.

#This program is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#along with this program.  If not, see <https://www.gnu.org/licenses/>.

#: import RGBA kivy.utils.rgba
#: import Window kivy.core.window.Window
#: import SlideTransition kivy.uix.screenmanager.SlideTransition
Screen_Manager:
    Login:
    Main:
    AddEntry:
<CustomLabel@Label>:
    color: app.color['main']
    font_name: 'Fonts/Montserrat-Light.ttf'
    disabled_color: self.color
    markup: True
<UIButton@Button>:
    background_normal: 'UI/Mainbuttondown.png'
    background_down: 'UI/Mainbutton.png'
    markup: True
    font_name: 'Fonts/Montserrat-Light.ttf'
    font: sp(15)
    color: app.color['font']
    background_disabled_normal: self.background_normal
    background_disabled_down: self.background_down
    disabled_color: self.color
<CustomTextInput>:
    background_color:  app.color['middle']
    background_normal: ''
    foreground_color: app.color['font']
    padding: 6,(self.height-self.line_height)/2,6,6
    multiline: False
    background_disabled_normal: ''
    font_name: 'Fonts/Montserrat-Light.ttf'
    font_size: self.width/22 if self.width/22>sp(18) else sp(18)
    cursor_color: app.color['main']
    hint_text_color: app.color['darkgrey']
    size_hint_y: None
    write_tab: False
    disabled_foreground_color: self.foreground_color if self.text else self.hint_text_color
    disabled_background_color: self.background_color if self.text else self.hint_text_color

#  --------------------- LOGIN SCREEN -----------------


<Login>:
    canvas:
	    Color:
	        rgba:30/255,30/255, 30/255, 1
		Rectangle: 
	        size: self.size
	        pos: self.pos
    name: 'login'
    BoxLayout: # this boxlayout centers the grid layout that contains the text inpot and buttons 
        canvas.before:
            Color:
                rgba:app.color['main']
            Line:
                points: [root.width/5,root.height,0,root.height,0,0]
                width: 10
                cap: "square"
            Line:
                points: [root.width-root.width/5,root.height,root.width,root.height,root.width,0]
                width: 10
                cap: "square"
        Widget: # Added widgets on each side of the gridlayout so that it's in between
            size_hint_x: 0.2 if app._platform!='android' else 0.08 # cause android has a lesser width
        GridLayout:
            cols: 1
            size_hint_max_x: dp(800) # this holds the grid layout in center, other wise the boxlayout down below sticks to left
            size_hint_min_x: dp(340)
            spacing: dp(30)
            padding: dp(20)
            CustomLabel:
                size_hint_y: 0.1
                text: 'Reminiscor'
                font_name: 'Fonts/Colchester.ttf'
                font_size: sp(80) if Window.size[1] < sp(670) else sp(95)
            BoxLayout: # this box layout is messy 
                canvas.before:
                    Color:
                        rgba: (37/255,37/255,37/255,1)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: 15,15,15,15
                size_hint_max_y: dp(400)
                orientation: 'vertical'
                padding: dp(40)
                spacing: dp(10)
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(10)
                    CustomLabel:
                        text: 'LOGIN:'
                        heigth: dp(30)
                        font_size: sp(30)
                    BoxLayout:
                        padding: dp(5)
                        spacing: dp(10)
                        CustomTextInput:
                            id: password
                            text: 'arjun2000'#remove this
                            hint_text: 'Master Password'
                            size_hint_y: None
                            password: True if view.state!='down' else False
                            height: dp(50)
                            font_size: self.width-self.width + sp(18)
                            halign: 'center'
                            size_hint_x: 0.8
                            size_hint_min_x: dp(160)
                            pos_hint: {'center_x': 0.5}
                    BoxLayout:
                        size_hint_y: None
                        height: dp(25)
                        Widget:
                        ToggleButton:
                            id:view
                            text: 'View'
                            color: app.color['main']
                            markup: True
                            size_hint: 0.2, None
                            height: dp(25)
                            size_hint_min_x: dp(42)
                            background_normal: 'UI/Mainbutton.png'
                            background_down: 'UI/editondown.png'
                        Widget:
                BoxLayout:
                    orientation: 'vertical'
                    spacing: dp(20)
                    UIButton:
                        id: login
                        text: 'Login'
                        size_hint_max_y: dp(50)
                        size_hint_x: 0.5
                        pos_hint:{'center_x': 0.5}
                        background_normal: 'UI/Mainbutton.png'
                        background_down: 'UI/Mainbuttondown.png'
                        on_release:
                            root.auth_login()
                    UIButton:
                        id: signup
                        text: 'SignUp'
                        size_hint_max_y: dp(50)
                        size_hint_x: 0.5
                        pos_hint:{'center_x': 0.5}
                        background_normal: 'UI/Mainbutton.png'
                        background_down: 'UI/Mainbuttondown.png'
                        on_release: root.call_signup()
            CustomLabel:
                text: 'E N C R Y P T I N G    A N X I E T I E S'
                font_size: root.width/30 if root.width/30<sp(30) else sp(30)
                size_hint_y: 0.1
        Widget:
            size_hint_x: 0.2 if app._platform!='android' else 0.08
    AnchorLayout:
        anchor_x: 'right'
        anchor_y: 'bottom'
        padding: dp(15), dp(10)
        BoxLayout:
            size_hint: None,None
            size: dp(50), dp(110)
            orientation: 'vertical'
            spacing: dp(10)
            UIButton:
                text: '?'
                font_size: sp(22)
                size_hint_y: None
                height: dp(50)
                on_release: root.tutorial()
            UIButton:
                text: 'i'
                font_size: sp(22)
                size_hint_y: None
                height: dp(50)
                on_release: root.welcome()
#  --------------------- WELCOME POPUP -----------------

<Welcome>:
    canvas.before:
        Color:
            rgba:app.color['main']
        Line:
            points: [self.x+self.width/5, self.top-dp(5), self.x, self.top-dp(5), self.x, self.y+dp(5)]
            width: 5
            cap: 'square'
        Line:
            points: [self.right-self.width/5, self.top-dp(5), self.right, self.top-dp(5), self.right, self.y+dp(5)]
            width: 5
            cap: 'square'
    orientation: 'vertical'
    padding: dp(20)
    spacing: dp(20)
    CustomLabel:
        text: 'Welcome'
        font_size: root.width/7 if root.width/7<sp(70) else sp(70)
        size_hint_max_y: dp(60)
        size_hint_y: 0.2
        font_name: 'Fonts/Colchester.ttf'
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        size_hint_y: 1
        bar_width: 3
        bar_color:[0,171/255,174/255,1]
        scroll_type: ['content', 'bars']
        CustomLabel:
            padding: dp(10), dp(10)
            text: root.text
            height: self.texture_size[1]
            text_size: self.width,None
            line_height: 1.5
            width: root.width - root.width/11
            halign: 'center'
            size_hint: None, None
            font_size: sp(18)
    GridLayout:
        spacing: dp(40)
        cols: 2
        padding: dp(10)
        size_hint_y: 0.25
        UIButton:
            id: close
            text: 'Close'
            size_hint_x: 0.3 if app._platform != 'android' else 0.35
            size_hint_max_y: dp(50)
            size_hint_min_y: dp(40)
            size_hint_min_x: dp(30)
        UIButton:
            id: tutorial
            text: 'Take The Tutorial'
            size_hint_max_x: dp(300)
            size_hint_max_y: dp(50)
            size_hint_min_y: dp(40)


#  --------------------- SIGN UP POPUP -----------------



<Signup>:
    padding: dp(10)
    spacing: dp(20)
    orientation: 'vertical'
    CustomLabel:
        text: 'SIGNUP'
        font_size: root.width/11
        size_hint_max_y: dp(60)
        size_hint_y: 0.2
    CustomTextInput:
        id: username
        size_hint_y: 0.15
        size_hint_max_y: dp(60)
        hint_text: 'Username (minimum: 3)'
    CustomTextInput:
        id: password
        size_hint_y: 0.15
        size_hint_max_y: dp(60)
        password: True
        hint_text: 'Master Password (minimum: 8)'
    CustomTextInput:
        id: c_password
        size_hint_y: 0.15
        size_hint_max_y: dp(60)
        password: True
        hint_text: 'Confirm Master Password'

    BoxLayout:
        id: keyfile
        canvas.before:
            Color:
                rgba:(25/255,25/255,25/255,1)
            RoundedRectangle:
                size: self.size
                pos: self.pos
                radius: 10,10,10,10
        size_hint_y: 0.15
        size_hint_max_y: dp(60)
        padding: dp(5), 0
        spacing: dp(2)
        pos_hint:{'x':0}
        CheckBox:
            id: enable
            pos_hint: {'x': 0}
            size_hint_x: 0.1
            size_hint_max_x: dp(40)
            background_checkbox_disabled_normal: self.background_checkbox_normal 
            background_checkbox_disabled_down: self.background_checkbox_down 
        CustomLabel:
            font_size: root.width/28 if root.width/28>sp(13) else sp(13)
            font_name: "Fonts/Montserrat-Regular.ttf"
            halign: 'center'
            color: app.color['font']
            line_height: 1.2
            text_size: keyfile.width-keyfile.width/10, None
            text: 'Enable KeyFile Authentication during Login.'  if app._platform != 'android' else "KeyFiles are not convenient for android, choose a strong password."
    GridLayout:
        canvas.before:
        size_hint_y: 0.25
        spacing: dp(40)
        padding: dp(20)
        cols:2
        UIButton:
            id: close
            size_hint_max_y: dp(50)
            size_hint_min_y: dp(40)
            text: 'Close'
        UIButton:
            id: confirm
            size_hint_max_y: dp(50)
            size_hint_min_y: dp(40)
            text: 'Confirm'





<Tutorial>:
    orientation: 'vertical'
    padding: dp(20)
    spacing: dp(20)
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        scroll_type: ['content', 'bars']
        bar_width: 5
        bar_color:[0,171/255,174/255,1]
        CustomLabel:
            id: label
            padding: dp(10), dp(10)
            text: root.text
            height: self.texture_size[1]
            text_size: self.width,None
            width: root.width - root.width/11
            #halign: 'center'
            color: app.color['font']
            line_height: 1.5
            size_hint: None, None
            font_size: sp(18)
    GridLayout:
        spacing: dp(40)
        cols: 2
        padding: dp(10)
        size_hint_y: 0.2
        UIButton:
            id: exit
            text: 'Exit'
            size_hint_max_y: dp(50)
            size_hint_min_y: dp(40)
            size_hint_min_x: dp(30)
        UIButton:
            id: next
            text: 'Next'
            size_hint_max_x: dp(300)
            size_hint_max_y: dp(50)
            size_hint_min_y: dp(40)
<QuickMessage>:
    orientation: 'vertical'
    spacing: dp(20)
    padding: dp(10)
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        scroll_type: ['content', 'bars']
        bar_width: 5
        bar_color:[0,171/255,174/255,1]
        CustomLabel:
            id: message
            padding: dp(10), dp(10)
            height: self.texture_size[1]
            text_size: self.width,None
            width: root.width - root.width/11
            #halign: 'center'
            color: app.color['font']
            line_height: 1.5
            size_hint: None, None
            font_size: sp(16)
    UIButton:
        id: close
        text: 'Close'
        size_hint: 0.3, None
        height: dp(35)
        pos_hint: {'right': 1}

<NavigationView>:
    orientation: 'vertical'
    BoxLayout:
        orientation:'vertical'
        spacing: dp(15)
        CustomLabel:
            text: 'N A V I G A T I O N'
            size_hint_y: None
            height: self.texture_size[1] + dp(20)
        BoxLayout:
            size_hint_y: None
            height: self.minimum_height
            Image:
                size_hint_min_y: dp(90)
                size_hint_max_y: dp(150)
                source: 'UI/logowithborder.png'
        BoxLayout:
            Widget:
                size_hint_max_y: dp(30)
                size_hint_y: 0.7
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: root.height*2/3
        UIButton:
            text: 'New Entry'
        UIButton:
            text: 'Import Entries'
        UIButton:
            text: 'Export Entries'
        UIButton:
            text: 'Backup'
        UIButton:
            text:'Settings'
        CustomLabel:
            text: 'Version 2.0.0'


<Main>:
    name: "main"
    on_pre_enter: root.on_enter_main()
    canvas:
	    Color:
	        rgba:30/255,30/255, 30/255, 1
		Rectangle: 
	        size: self.size
	        pos: self.pos
    BoxLayout:
        canvas.before:
            Color:
                rgba:app.color["main"]
            Line:
                points: [root.width/3, root.height-dp(80), 5, root.height-dp(80), 5, 0]
                width: 5
                cap: "square"
            Line:
                points: [root.width - root.width/3, root.height-dp(80), root.width - 5, root.height-dp(80), root.width-5, 0]
                width: 5
                cap: "square"
        orientation: 'vertical'
        spacing: dp(4)
        GridLayout:
            id: navigation_bar
            cols: 4
            size_hint_y: None
            height: dp(70)
            padding: dp(10)
            Image:
                id: logo
                size_hint: None, None
                size: dp(55), dp(55)
                source: 'UI/logowithborder.png'
            BoxLayout:
                orientation: 'vertical'
                padding: dp(10)
                spacing: dp(25)
                CustomLabel:
                    width: self.texture_size[0]
                    size_hint_x: None
                    text: 'Reminiscor'
                    font_name: 'Fonts/Colchester.ttf'
                    font_size: sp(40)
                CustomLabel:
                    size_hint_x: None
                    width: self.texture_size[0] + dp(5)
                    text: 'Welcome, ' + root.username
                    text_size: dp(160), None
                    shorten: True 
                    shorten_from: 'right'
                    font_size: sp(16) if self.texture_size[0]<=dp(150) else sp(14)
            BoxLayout:
                id: nav_bar_buttons
                Widget:
                UIButton:
                    id: logout
                    text: 'Logout'
                    size_hint: None, None
                    size: dp(80), dp(50)
                    on_release: root.logout()
                Widget:
                    size_hint_x: None
                    width: dp(25)
                UIButton:
                    id: nav
                    size_hint: None, None
                    size: dp(50), dp(50)
                    on_release: root.navigation()
        BoxLayout:
            size_hint_y: None
            height: dp(45)
            Widget:
            CustomTextInput:
                size_hint_y: None
                height: dp(45)
                hint_text: 'Search the Database' 
                size_hint_min_x: dp(275)
            Widget:
        BoxLayout:
            opacity: 0 if app.database == [] else 1
            padding: 0,dp(40),0,0
            BoxLayout:
                orientation: 'vertical'
                GridLayout:
                    id: attributes
                    canvas.before:
                        Color:
                            rgba:(40/255,40/255,40/255,1)
                        Rectangle:
                            size: self.size
                            pos: self.pos
                        Color:
                            rgba: app.color['main']
                        Line:
                            points: [self.x + dp(20), self.y + dp(1), self.x + dp(20), self.y+self.height - dp(11)]
                            width: dp(1.2)
                            cap: 'square'
                    cols: 5
                    size_hint:None, None
                    width: rv.width
                    pos_hint: {'center_x': 0.5}
                    height: dp(50)
                    padding: dp(20), dp(10), dp(20), 0
                    UIButton:
                        background_down: 'UI/Mainbuttondown.png'
                        color: app.color['main']
                        size_hint_x: None
                        width: cm(0.7)
                    UIButton:
                        background_down: 'UI/Mainbuttondown.png'
                        color: app.color['main']
                        text: 'Entry Name'
                        size_hint_x: 0.3
                        size_hint_min_x: cm(2)
                    UIButton:
                        text: 'Copy Data'
                        background_down: 'UI/Mainbuttondown.png'
                        color: app.color['main']
                        font_size: sp(14)
                        size_hint_x: 0.2
                    UIButton:
                        text: 'URL'
                        background_down: 'UI/Mainbuttondown.png'
                        color: app.color['main']
                        size_hint_x: 0.1
                    UIButton:
                        text: 'Category'
                        color: app.color['main']
                        font_size: sp(14)
                        text_size: self.width - self.width/10, None
                        shorten: True
                        halign: 'center'
                        shorten_from: 'right'
                        background_down: 'UI/Mainbuttondown.png'
                        size_hint_x: 0.2
                BoxLayout:
                    Widget:
                        size_hint_x: 0.1
                    RecycleView:
                        viewclass: "Entry"
                        data: app.database
                        RecycleGridLayout:
                            id: rv
                            canvas.before:
                                Color:
                                    rgba:(40/255,40/255,40/255,1)
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            cols: 1
                            padding: dp(20),0, dp(20), dp(10)
                            default_size_hint: 1, None
                            default_size: None, dp(80)
                            size_hint: 1, None
                            height: self.minimum_height
                    Widget:        
                        size_hint_x: 0.1
<Entry>:
    cols: 5
    canvas.before:
        Color:
            rgba: app.color['main']
        Line:
            points: [self.x, self.y + dp(1), self.x, self.y + self.height - dp(1)]
            width: dp(1.2)
    UIButton:
        background_down: 'UI/Mainbuttondown.png'
        id: entry_serial_no
        text: root.serial_no
        size_hint_x: None
        width: cm(0.7)
    UIButton:
        id: entry_name_url
        font_size: sp(14.5)
        shorten: True
        shorten_from: 'right'
        text_size: self.width-self.width/10, None
        halign: 'center'
        text: root.name
        size_hint_x: 0.3
        size_hint_min_x: cm(2)
    BoxLayout:
        id: copy_col
        orientation: 'vertical'
        size_hint_x: 0.2
        UIButton:
            text: "Copy Username" 
            text_size: self.width - self.width/10, None
            halign: 'center'
            font_size: sp(14)
            shorten: True
            shorten_from: 'right'
        UIButton:
            text: "Copy Password"
            text_size: self.width - self.width/10, None
            halign: 'center'
            shorten: True
            shorten_from: 'right'
            font_size: sp(14)
    UIButton:
        id: open_url
        size_hint_x: 0.1
    BoxLayout:
        canvas.before:
            Color:
                rgba:(30/255,30/255,30/255,1)
            Rectangle:
                size: self.size
                pos: self.pos
        id: database_and_category
        size_hint_x: 0.2
        orientation: 'vertical'
        UIButton:
            background_down: 'UI/Mainbuttondown.png'
        UIButton:
            background_down: 'UI/Mainbuttondown.png'
